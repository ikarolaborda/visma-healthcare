[Unit]
Description=Healthcare Celery Worker
After=network.target rabbitmq-server.service redis.service

[Service]
Type=forking
User={{ app_user }}
Group={{ app_group }}
WorkingDirectory={{ app_directory }}/backend
Environment="PATH={{ app_directory }}/backend/venv/bin"
EnvironmentFile={{ app_directory }}/.env
ExecStart={{ app_directory }}/backend/venv/bin/celery -A config worker -l {{ celery_worker_log_level }} --concurrency={{ celery_worker_concurrency }} --pidfile=/var/run/celery/worker.pid --logfile=/var/log/{{ app_name }}/celery-worker.log
ExecStop=/bin/kill -s TERM $MAINPID
Restart=on-failure
RuntimeDirectory=celery
RuntimeDirectoryMode=0755

[Install]
WantedBy=multi-user.target
